<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Rethomics, a framework for high-throughput behaviour analysis in R</title>
  <meta name="description" content="This is a tutorial for Rethomics, a framework to analyse high-throuput behavioural data in <code>R</code>.">
  <meta name="generator" content="bookdown 0.7.12 and GitBook 2.6.7">

  <meta property="og:title" content="Rethomics, a framework for high-throughput behaviour analysis in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a tutorial for Rethomics, a framework to analyse high-throuput behavioural data in <code>R</code>." />
  <meta name="github-repo" content="rethomics/rethomics.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Rethomics, a framework for high-throughput behaviour analysis in R" />
  
  <meta name="twitter:description" content="This is a tutorial for Rethomics, a framework to analyse high-throuput behavioural data in <code>R</code>." />
  

<meta name="author" content="Quentin Geissmann">


<meta name="date" content="2018-06-06">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="sleepr.html">
<link rel="next" href="community.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110947778-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110947778-1');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/my_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Rethomics Tutorial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i>Package List and First Steps</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#getting-r"><i class="fa fa-check"></i>Getting R</a></li>
<li><a href="intro.html#the-rethomics-packages">The <code>rethomics</code> packages</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#installation"><i class="fa fa-check"></i>Installation</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#cran"><i class="fa fa-check"></i>CRAN</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#devtools"><i class="fa fa-check"></i>devtools</a></li>
</ul></li>
</ul></li>
<li><a href="workflow.html#workflow">The <code>rethomics</code> workflow</a></li>
<li class="chapter" data-level="" data-path="metadata.html"><a href="metadata.html"><i class="fa fa-check"></i>Working with metadata files</a><ul>
<li class="chapter" data-level="" data-path="metadata.html"><a href="metadata.html#what-are-metadata"><i class="fa fa-check"></i>What are metadata?</a></li>
<li class="chapter" data-level="" data-path="metadata.html"><a href="metadata.html#make-them-exhaustive"><i class="fa fa-check"></i>Make them exhaustive</a></li>
<li class="chapter" data-level="" data-path="metadata.html"><a href="metadata.html#put-replicates-together"><i class="fa fa-check"></i>Put replicates together</a></li>
<li class="chapter" data-level="" data-path="metadata.html"><a href="metadata.html#linking-metadata"><i class="fa fa-check"></i>Linking metadata</a></li>
<li class="chapter" data-level="" data-path="metadata.html"><a href="metadata.html#take-home-message"><i class="fa fa-check"></i>Take home message</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="behavr.html"><a href="behavr.html"><i class="fa fa-check"></i>behavr tables</a><ul>
<li class="chapter" data-level="" data-path="behavr.html"><a href="behavr.html#variables-and-metavariables"><i class="fa fa-check"></i>Variables and metavariables</a></li>
<li><a href="behavr.html#operating-on-behavr-tables">Operating on <code>behavr</code> tables</a></li>
<li class="chapter" data-level="" data-path="behavr.html"><a href="behavr.html#playing-with-toy-data"><i class="fa fa-check"></i>Playing with toy data</a></li>
<li class="chapter" data-level="" data-path="behavr.html"><a href="behavr.html#generalities"><i class="fa fa-check"></i>Generalities</a><ul>
<li class="chapter" data-level="" data-path="behavr.html"><a href="behavr.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="metadata.html"><a href="metadata.html#metadata"><i class="fa fa-check"></i>Metadata</a></li>
<li class="chapter" data-level="" data-path="behavr.html"><a href="behavr.html#summarise-data"><i class="fa fa-check"></i>Summarise data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html"><i class="fa fa-check"></i>DAM2 data, in practice</a><ul>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#aims"><i class="fa fa-check"></i>Aims</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#background"><i class="fa fa-check"></i>Background</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#getting-the-data"><i class="fa fa-check"></i>Getting the data</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#from-experiment-design-to-metadata"><i class="fa fa-check"></i>From experiment design to metadata</a><ul>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#our-toy-experiment"><i class="fa fa-check"></i>Our toy experiment</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#metadata-1"><i class="fa fa-check"></i>Metadata</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#linking"><i class="fa fa-check"></i>Linking</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#loading"><i class="fa fa-check"></i>Loading</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#note-on-datetime"><i class="fa fa-check"></i>Note on datetime</a><ul>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#zt0"><i class="fa fa-check"></i>ZT0</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#start-and-stop-time"><i class="fa fa-check"></i>Start and stop time</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#quality-control"><i class="fa fa-check"></i>Quality control</a><ul>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#detecting-anomalies"><i class="fa fa-check"></i>Detecting anomalies</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#how-to-exclude-animals"><i class="fa fa-check"></i>How to exclude animals?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#apply-functions-when-loading"><i class="fa fa-check"></i>Apply functions when loading</a></li>
<li class="chapter" data-level="" data-path="damr.html"><a href="damr.html#next-steps"><i class="fa fa-check"></i>Next steps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html"><i class="fa fa-check"></i>Ethoscope data, in practice</a><ul>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#aims-1"><i class="fa fa-check"></i>Aims</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#background-1"><i class="fa fa-check"></i>Background</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#getting-the-data-1"><i class="fa fa-check"></i>Getting the data</a><ul>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#extract-the-zipped-data"><i class="fa fa-check"></i>Extract the zipped data</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#note-on-the-data-structure"><i class="fa fa-check"></i>Note on the data structure</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#set-your-working-directory"><i class="fa fa-check"></i>Set your working directory</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#from-experiment-design-to-metadata-1"><i class="fa fa-check"></i>From experiment design to metadata</a><ul>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#our-toy-experiment-1"><i class="fa fa-check"></i>Our toy experiment</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#metadata-2"><i class="fa fa-check"></i>Metadata</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#linking-1"><i class="fa fa-check"></i>Linking</a><ul>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#local-data"><i class="fa fa-check"></i>Local data</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#remote-data"><i class="fa fa-check"></i>Remote Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#loading-1"><i class="fa fa-check"></i>Loading</a><ul>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#raw-data-default"><i class="fa fa-check"></i>Raw data (default)</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#preprocessing"><i class="fa fa-check"></i>Preprocessing</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#zt0-1"><i class="fa fa-check"></i>ZT0</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#cache-directory"><i class="fa fa-check"></i>Cache directory</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#quality-control-1"><i class="fa fa-check"></i>Quality control</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#and-then"><i class="fa fa-check"></i>And then?</a><ul>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#sleep-amount-vs-treatment"><i class="fa fa-check"></i>Sleep amount vs treatment</a></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#total-sleep-vs-expression-level"><i class="fa fa-check"></i>Total sleep vs expression level</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="scopr.html"><a href="scopr.html#next-steps-1"><i class="fa fa-check"></i>Next steps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html"><i class="fa fa-check"></i>Visualisation with ggetho</a><ul>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#aims-2"><i class="fa fa-check"></i>Aims</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#prerequisites-2"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#lessons-from-ggplot"><i class="fa fa-check"></i>Lessons from ggplot</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#some-behavioural-data"><i class="fa fa-check"></i>Some behavioural data</a></li>
<li><a href="ggetho.html#the-ggetho-function">The <code>ggetho()</code> function</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#tile-plots"><i class="fa fa-check"></i>Tile plots</a><ul>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#per-individual"><i class="fa fa-check"></i>Per individual</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#sorted-individual"><i class="fa fa-check"></i>Sorted individual</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#group-averages"><i class="fa fa-check"></i>Group averages</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#bar-tiles"><i class="fa fa-check"></i>Bar tiles</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#population-plots"><i class="fa fa-check"></i>Population plots</a><ul>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#one-population"><i class="fa fa-check"></i>One population</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#several-populations"><i class="fa fa-check"></i>Several populations</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#wrapping-data"><i class="fa fa-check"></i>Wrapping data</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#double-plotted-actograms"><i class="fa fa-check"></i>Double-plotted actograms</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#faceting-by-id"><i class="fa fa-check"></i>Faceting by ID</a><ul>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#default"><i class="fa fa-check"></i>Default</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#custom-labeller"><i class="fa fa-check"></i>Custom labeller</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#numerical-labelling"><i class="fa fa-check"></i>Numerical labelling</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#ld-annotations"><i class="fa fa-check"></i>LD annotations</a><ul>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#basics"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#changing-ld-colours"><i class="fa fa-check"></i>Changing LD colours</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#ld-in-the-background"><i class="fa fa-check"></i>LD in the background</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#phase-and-period"><i class="fa fa-check"></i>Phase and period</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#regime-change"><i class="fa fa-check"></i>Regime change</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#coordinate-and-scales"><i class="fa fa-check"></i>Coordinate and scales</a><ul>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#plot-limits"><i class="fa fa-check"></i>Plot limits</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#time-scale-units"><i class="fa fa-check"></i>Time scale units</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#coordinate-systems"><i class="fa fa-check"></i>Coordinate systems</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#periodograms"><i class="fa fa-check"></i>Periodograms</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#take-home-message-1"><i class="fa fa-check"></i>Take home message</a></li>
<li class="chapter" data-level="" data-path="ggetho.html"><a href="ggetho.html#next-steps-2"><i class="fa fa-check"></i>Next steps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html"><i class="fa fa-check"></i>Sleep analysis</a><ul>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#aims-3"><i class="fa fa-check"></i>Aims</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#background-2"><i class="fa fa-check"></i>Background</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#getting-the-data-2"><i class="fa fa-check"></i>Getting the data</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#data-curation"><i class="fa fa-check"></i>Data curation</a><ul>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#dead-animals"><i class="fa fa-check"></i>Dead animals</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#animals-that-died-too-early"><i class="fa fa-check"></i>Animals that died too early</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#trimming"><i class="fa fa-check"></i>Trimming</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#population-plots-1"><i class="fa fa-check"></i>Population plots</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#summarise-data-per-animal"><i class="fa fa-check"></i>Summarise data per animal</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#day-sleep-night-sleep"><i class="fa fa-check"></i>Day sleep☼ – Night sleep☾</a><ul>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#adding-some-phase-information"><i class="fa fa-check"></i>Adding some phase information</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#statistics"><i class="fa fa-check"></i>Statistics</a><ul>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#pairwise-wilcoxon-tests"><i class="fa fa-check"></i>Pairwise Wilcoxon tests</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#two-way-anova"><i class="fa fa-check"></i>Two way anova</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#sleep-architecture"><i class="fa fa-check"></i>Sleep architecture</a><ul>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#bout-analysis"><i class="fa fa-check"></i>Bout analysis</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#bout-length-vs-time-of-the-day"><i class="fa fa-check"></i>Bout length vs time of the day</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#architecture-description"><i class="fa fa-check"></i>Architecture description</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#latency-to-sleep"><i class="fa fa-check"></i>Latency to sleep</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#merging-all-statistics"><i class="fa fa-check"></i>Merging all statistics</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#take-home-message-2"><i class="fa fa-check"></i>Take home message</a></li>
<li class="chapter" data-level="" data-path="sleepr.html"><a href="sleepr.html#next-steps-3"><i class="fa fa-check"></i>Next steps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html"><i class="fa fa-check"></i>Circadian rhythm analysis</a><ul>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#aims-4"><i class="fa fa-check"></i>Aims</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#background-3"><i class="fa fa-check"></i>Background</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#getting-the-data-3"><i class="fa fa-check"></i>Getting the data</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#quality-control-2"><i class="fa fa-check"></i>Quality control</a><ul>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#regime-changes"><i class="fa fa-check"></i>Regime changes</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#data-enrichment"><i class="fa fa-check"></i>Data enrichment</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#overview-plots"><i class="fa fa-check"></i>Overview plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#double-plotted-actograms-1"><i class="fa fa-check"></i>Double plotted actograms</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#periodograms-1"><i class="fa fa-check"></i>Periodograms</a><ul>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#computation"><i class="fa fa-check"></i>Computation</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#peaks-finding"><i class="fa fa-check"></i>Peaks finding</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#visualisation"><i class="fa fa-check"></i>Visualisation</a></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#exctract-the-peak-values"><i class="fa fa-check"></i>Exctract the peak values</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="zeitgebr.html"><a href="zeitgebr.html#next-steps-4"><i class="fa fa-check"></i>Next steps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="community.html"><a href="community.html"><i class="fa fa-check"></i>Issues and community</a><ul>
<li class="chapter" data-level="" data-path="community.html"><a href="community.html#citation"><i class="fa fa-check"></i>Citation</a></li>
<li class="chapter" data-level="" data-path="community.html"><a href="community.html#having-troubles"><i class="fa fa-check"></i>Having troubles</a></li>
<li class="chapter" data-level="" data-path="community.html"><a href="community.html#contributing"><i class="fa fa-check"></i>Contributing</a></li>
</ul></li>
<li class="divider"></li>
<li>
<a href="https://doi.org/10.1101/305664" target="blank">Cite rethomics</a>
<a href="https://bookdown.org/yihui/bookdown/" target="blank">Published with bookdown</a>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Rethomics, a framework for high-throughput behaviour analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="zeitgebr" class="section level1 unnumbered">
<h1>Circadian rhythm analysis</h1>
<!-- **TODO the perfect one liner** -->
<!-- --------------------------- -->
<!-- ![TODO add some figure]("rethomics_files/figure-html/achitecture-1.png") -->
<div id="aims-4" class="section level2 unnumbered">
<h2>Aims</h2>
<p>In this practical chapter, we will use a real experiment to learn how to:</p>
<ul>
<li>Use <code>zeitgebr</code> to compute periodograms</li>
<li>Use <a href="ggetho.html">ggetho</a> to draw double plotted actograms</li>
<li>Average periodograms vs conditions</li>
<li>Find and compare peaks</li>
</ul>
</div>
<div id="prerequisites-4" class="section level2 unnumbered">
<h2>Prerequisites</h2>
<ul>
<li>You have read about <a href="behavr.html">behavr tables</a></li>
<li>You are familiar with <a href="ggetho.html">ggetho</a>, our visualisation tool</li>
<li>You have already read the <a href="damr.html">damr tutorial</a></li>
<li>Ensure you have <a href="intro.html#installing-rethomics-packages">installed</a> <code>behavr</code>, <code>damr</code>, <code>ggetho</code> and <code>zeitgebr</code> packages</li>
</ul>
</div>
<div id="background-3" class="section level2 unnumbered">
<h2>Background</h2>
<p>This tutorial focuses on circadian rhythm in <em>Drosophila</em>, but can be adapted easily to investigate periodicity in different contexts. In it, we will use a DAM dataset that is provided (and preloaded) within the <code>damr</code> package.</p>
</div>
<div id="getting-the-data-3" class="section level2 unnumbered">
<h2>Getting the data</h2>
<p>Getting the data is a lot simpler than in the other tutorials as it is already on your computer:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(damr)
<span class="kw">library</span>(zeitgebr)
<span class="kw">library</span>(ggetho)

<span class="co"># We load the data</span>
<span class="kw">data</span>(dams_sample) 
<span class="co"># We copy the data to our own variable so we can alter it</span>
dt &lt;-<span class="st"> </span><span class="kw">copy</span>(dams_sample) </code></pre></div>
<p>This data set is a recording of 32 animals, in DD. Let us print the metadata to understand the experiment a little bit:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(dt)</code></pre></div>
<pre><code>## behavr table with:
##  32  individuals
##  6   metavariables
##  2   variables
##  4.1504e+05  measurements
##  1   key (id)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(dt[<span class="dt">meta=</span>T])</code></pre></div>
<pre><code>##                                         id file_info region_id
##  1: 2017-01-16 08:00:00|dams_sample.txt|01    &lt;list&gt;         1
##  2: 2017-01-16 08:00:00|dams_sample.txt|02    &lt;list&gt;         2
##  3: 2017-01-16 08:00:00|dams_sample.txt|03    &lt;list&gt;         3
##  4: 2017-01-16 08:00:00|dams_sample.txt|04    &lt;list&gt;         4
##  5: 2017-01-16 08:00:00|dams_sample.txt|05    &lt;list&gt;         5
## ---                                                           
## 28: 2017-01-16 08:00:00|dams_sample.txt|28    &lt;list&gt;        28
## 29: 2017-01-16 08:00:00|dams_sample.txt|29    &lt;list&gt;        29
## 30: 2017-01-16 08:00:00|dams_sample.txt|30    &lt;list&gt;        30
## 31: 2017-01-16 08:00:00|dams_sample.txt|31    &lt;list&gt;        31
## 32: 2017-01-16 08:00:00|dams_sample.txt|32    &lt;list&gt;        32
##                           experiment_id      start_datetime
##  1: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  2: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  3: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  4: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  5: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## ---                                                        
## 28: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 29: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 30: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 31: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 32: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##           stop_datetime period_group
##  1: 2017-01-26 00:09:00         long
##  2: 2017-01-26 00:09:00         long
##  3: 2017-01-26 00:09:00         long
##  4: 2017-01-26 00:09:00         long
##  5: 2017-01-26 00:09:00         long
## ---                                 
## 28: 2017-01-26 00:09:00           wt
## 29: 2017-01-26 00:09:00           wt
## 30: 2017-01-26 00:09:00           wt
## 31: 2017-01-26 00:09:00           wt
## 32: 2017-01-26 00:09:00           wt</code></pre>
<p>We can confirm we have 32 individuals. They are described by one of three “period groups” (e.g. a genotype or treatment). This is encoded in <code>period_group</code> metavariable can be either a “short”“,”long“” or wild-type (“wt”) period.</p>
</div>
<div id="quality-control-2" class="section level2 unnumbered">
<h2>Quality control</h2>
<p>This data is fairly clean already, so we will not do much. For most purposes, you can apply the same principles as <a href="sleepr.html#data-curation">data curation for sleep analysis</a>.</p>
<div id="regime-changes" class="section level3 unnumbered">
<h3>Regime changes</h3>
<p>In general (but not here), you will have a period of <code>LD</code> <strong>“baseline”</strong> preceding a change to a <code>DD</code> regime. I suggest to encode that in the following way:</p>
<ol style="list-style-type: decimal">
<li>Manually add a column <code>baseline_days</code> in your metadata that defines the <strong>number of days of baseline</strong>.</li>
<li><strong>Sustract the number of baseline days</strong> to all time points: <code>dt[, t := t - days(xmv(baseline_days))]</code></li>
</ol>
<p>As a result, <code>t = 0</code> now means “ZT0 of the transition day”. This makes a lot of sense as any baseline point is at a negative time (<code>t &lt; 0</code>), whilst <code>t &gt; 0</code> is for <code>DD</code>. The nice thing is that you can work with data (e.g. replicates) that have different baseline duration as now <strong>all time points are relative to the regime change</strong>.</p>
</div>
<div id="data-enrichment" class="section level3 unnumbered">
<h3>Data enrichment</h3>
<p>By defaut, DAM data only has variables <code>t</code> and <code>activity</code>. The latter being the number of beam crosses over a time bin (e.g. one minute). We could define a variable <code>moving</code> that is <code>TRUE</code> when and only when <code>activity &gt; 0</code>, and <code>FALSE</code> otherwise:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[, moving <span class="op">:</span><span class="er">=</span><span class="st"> </span>activity <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</code></pre></div>
</div>
<div id="overview-plots" class="section level3 unnumbered">
<h3>Overview plots</h3>
<p>The first representation we show could be the activity of all animals over time in the same page. This would help to spot outliers. We simply do that with our <strong>tile plot</strong>. Note how we have changed the LD colours to grey and black, grey being for subjective days (remember, we are in DD).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggetho</span>(dt, <span class="kw">aes</span>(<span class="dt">z=</span>activity)) <span class="op">+</span>
<span class="st">      </span><span class="kw">stat_ld_annotations</span>(<span class="dt">ld_colours =</span> <span class="kw">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;black&quot;</span>))<span class="op">+</span>
<span class="st">      </span><span class="kw">stat_tile_etho</span>() </code></pre></div>
<p><img src="rethomics_files/figure-html/unnamed-chunk-126-1.png" width="864" /></p>
<p>Note that you can substitute other variables you have in <code>dt</code> (e.g. <code>moving</code>) for <code>activity</code>.</p>
<p>We see that two animals (region 5 and 10) seem to have died/escaped before the end of the experiment. There is no right thing to do regarding dead animals. You could keep the data before death, or remove them altogether. <strong>It is eventually your responsibility to decide what to do with dead animals</strong>. Here, I simply remove data after death:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sleepr)
dt_curated &lt;-<span class="st"> </span><span class="kw">curate_dead_animals</span>(dt)
<span class="kw">summary</span>(dt_curated)</code></pre></div>
<pre><code>## behavr table with:
##  32  individuals
##  6   metavariables
##  3   variables
##  4.06864e+05 measurements
##  1   key (id)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggetho</span>(dt_curated, <span class="kw">aes</span>(<span class="dt">z=</span>activity)) <span class="op">+</span>
<span class="st">      </span><span class="kw">stat_ld_annotations</span>(<span class="dt">ld_colours =</span> <span class="kw">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;black&quot;</span>))<span class="op">+</span>
<span class="st">      </span><span class="kw">stat_tile_etho</span>() </code></pre></div>
<p><img src="rethomics_files/figure-html/unnamed-chunk-127-1.png" width="672" /></p>
<p>Our curated data is now stored in <code>dt_curated</code>.</p>
</div>
</div>
<div id="double-plotted-actograms-1" class="section level2 unnumbered">
<h2>Double plotted actograms</h2>
<p>At the moment, the <code>id</code> is a very long string (e.g. <code>&quot;2017-01-16 08:00:00|dams_sample.txt|01&quot;</code>). It has the advantage to be unambiguous, but it is difficult to plot. To help plotting, we can make a new variable that is simply <strong>a different number for each individual</strong>. Lets call it <code>uid</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt_curated[, uid <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span> <span class="op">:</span><span class="st"> </span>.N, meta=T]
<span class="co"># We can map uid to id</span>
dt_curated[, .(id, uid) ,meta=T]</code></pre></div>
<pre><code>##                                         id uid
##  1: 2017-01-16 08:00:00|dams_sample.txt|01   1
##  2: 2017-01-16 08:00:00|dams_sample.txt|02   2
##  3: 2017-01-16 08:00:00|dams_sample.txt|03   3
##  4: 2017-01-16 08:00:00|dams_sample.txt|04   4
##  5: 2017-01-16 08:00:00|dams_sample.txt|05   5
## ---                                           
## 28: 2017-01-16 08:00:00|dams_sample.txt|28  28
## 29: 2017-01-16 08:00:00|dams_sample.txt|29  29
## 30: 2017-01-16 08:00:00|dams_sample.txt|30  30
## 31: 2017-01-16 08:00:00|dams_sample.txt|31  31
## 32: 2017-01-16 08:00:00|dams_sample.txt|32  32</code></pre>
<p>As you see, we do keep <code>id</code> as a reference but <code>uid</code> for convenience in graphs.</p>
<p>To make a double plotted actogram, we use <code>ggetho</code>. Read more about that in the <a href="ggetho.html#double-plotted-actograms">visualisation tutorial</a>. Briefly, we set <code>multiplot</code> to <code>2</code> (<code>3</code> would be a triple plotted) one. The variable of interest is on the <code>z</code> axis. Note that instead of <code>moving</code>, you could plot raw <code>activity</code>. Then, we use bar height to show the amount of movement (we could use <code>stat_tile_etho</code> which shows the variable of interest as a colour with pixel intensity). Lastly, we split the graph by <code>uid</code>, so that each facet is a single animal.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggetho</span>(dt_curated, <span class="kw">aes</span>(<span class="dt">z =</span> moving), <span class="dt">multiplot =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">stat_bar_tile_etho</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>uid, <span class="dt">ncol =</span> <span class="dv">8</span>)</code></pre></div>
<p><img src="rethomics_files/figure-html/unnamed-chunk-129-1.png" width="1152" /></p>
<p>Interestingly, you can use formula in facet to show or sort with other metavariables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggetho</span>(dt_curated, <span class="kw">aes</span>(<span class="dt">z=</span>moving), <span class="dt">multiplot =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">stat_bar_tile_etho</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>period_group <span class="op">+</span><span class="st"> </span>uid, <span class="dt">ncol=</span><span class="dv">8</span>, <span class="dt">labeller =</span> <span class="kw">label_wrap_gen</span>(<span class="dt">multi_line=</span><span class="ot">FALSE</span>))</code></pre></div>
<p><img src="rethomics_files/figure-html/unnamed-chunk-130-1.png" width="1152" /> Now, we know which genotype matches each <code>uid</code>. In your own work, you could generalise this concept to display more metavariables. For instance, if you had a <code>sex</code> metavariable you could do: <code>facet_wrap( ~ period_group + sex + uid, ...)</code>.</p>
</div>
<div id="periodograms-1" class="section level2 unnumbered">
<h2>Periodograms</h2>
<div id="computation" class="section level3 unnumbered">
<h3>Computation</h3>
<p>An important part of circadian research is to compute the periodicity of the free running clock of multiple individuals. Mathematically, we would like to build a preiodogram. That is, generally speaking, a representation of the density (i.e. <strong>power</strong>) of a signal at different <strong>periods</strong> (or frequencies). In addition, a periodogram associates to each pair of power-period a <strong>significance level</strong>. There are many algorithms to compute periodograms. In <code>zeitgebr</code>, we have so far implemented:</p>
<ul>
<li><code>ac_periodogram</code> – An <em>autocorrelation</em> based method</li>
<li><code>ls_periodogram</code> – <em>Lomb-Scargle</em> algorithm</li>
<li><code>chi_sq_periodogram</code> – A <em><span class="math inline">\(\chi{}^2\)</span></em> based one</li>
</ul>
<p>See <code>?periodogram_methods</code> for references.</p>
<p>In order to compute periodograms, we use the <code>periodogram()</code> function. We need to define which variable we want to study (e.g. <code>moving</code> or <code>activity</code>). Then, we provide our data. The methods described above can be passed as an argument.</p>
<p>For instance, if we want to analyse, with the <span class="math inline">\(\chi{}^2\)</span> method, activity:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">per_xsq_dt &lt;-<span class="st"> </span><span class="kw">periodogram</span>(activity, 
                        dt_curated,
                        <span class="dt">FUN =</span> chi_sq_periodogram)
per_xsq_dt</code></pre></div>
<pre><code>## 
##  ==== METADATA ====
## 
##                                         id file_info region_id
##                                     &lt;fctr&gt;    &lt;list&gt;     &lt;int&gt;
##  1: 2017-01-16 08:00:00|dams_sample.txt|01    &lt;list&gt;         1
##  2: 2017-01-16 08:00:00|dams_sample.txt|02    &lt;list&gt;         2
##  3: 2017-01-16 08:00:00|dams_sample.txt|03    &lt;list&gt;         3
##  4: 2017-01-16 08:00:00|dams_sample.txt|04    &lt;list&gt;         4
##  5: 2017-01-16 08:00:00|dams_sample.txt|05    &lt;list&gt;         5
## ---                                                           
## 28: 2017-01-16 08:00:00|dams_sample.txt|28    &lt;list&gt;        28
## 29: 2017-01-16 08:00:00|dams_sample.txt|29    &lt;list&gt;        29
## 30: 2017-01-16 08:00:00|dams_sample.txt|30    &lt;list&gt;        30
## 31: 2017-01-16 08:00:00|dams_sample.txt|31    &lt;list&gt;        31
## 32: 2017-01-16 08:00:00|dams_sample.txt|32    &lt;list&gt;        32
##                           experiment_id      start_datetime
##                                  &lt;char&gt;              &lt;POSc&gt;
##  1: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  2: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  3: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  4: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  5: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## ---                                                        
## 28: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 29: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 30: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 31: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 32: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##           stop_datetime period_group   uid
##                  &lt;fctr&gt;       &lt;fctr&gt; &lt;int&gt;
##  1: 2017-01-26 00:09:00         long     1
##  2: 2017-01-26 00:09:00         long     2
##  3: 2017-01-26 00:09:00         long     3
##  4: 2017-01-26 00:09:00         long     4
##  5: 2017-01-26 00:09:00         long     5
## ---                                       
## 28: 2017-01-26 00:09:00           wt    28
## 29: 2017-01-26 00:09:00           wt    29
## 30: 2017-01-26 00:09:00           wt    30
## 31: 2017-01-26 00:09:00           wt    31
## 32: 2017-01-26 00:09:00           wt    32
## 
##  ====== DATA ======
## 
##                                           id period     power
##                                       &lt;fctr&gt;  &lt;num&gt;     &lt;num&gt;
##    1: 2017-01-16 08:00:00|dams_sample.txt|01  57600  34.17475
##    2: 2017-01-16 08:00:00|dams_sample.txt|01  57960  34.17475
##    3: 2017-01-16 08:00:00|dams_sample.txt|01  58320  59.19905
##    4: 2017-01-16 08:00:00|dams_sample.txt|01  58680  59.19905
##    5: 2017-01-16 08:00:00|dams_sample.txt|01  59040  37.79175
##   ---                                                        
## 5148: 2017-01-16 08:00:00|dams_sample.txt|32 113760 100.21510
## 5149: 2017-01-16 08:00:00|dams_sample.txt|32 114120 124.12366
## 5150: 2017-01-16 08:00:00|dams_sample.txt|32 114480 124.12366
## 5151: 2017-01-16 08:00:00|dams_sample.txt|32 114840 127.12975
## 5152: 2017-01-16 08:00:00|dams_sample.txt|32 115200 127.12975
##       signif_threshold   p_value
##                  &lt;num&gt;     &lt;num&gt;
##    1:         116.7888 0.9991894
##    2:         116.7888 0.9991894
##    3:         118.1251 0.6793185
##    4:         118.1251 0.6793185
##    5:         119.4588 0.9979513
##   ---                           
## 5148:         196.2269 0.9561612
## 5149:         197.4675 0.5556435
## 5150:         197.4675 0.5556435
## 5151:         198.7071 0.5051096
## 5152:         198.7071 0.5051096</code></pre>
<p>The result is another <code>behavr</code> table, with the same metadata. The data however, is now a list of power vs period (and significance).</p>
<p>Have a look at the other options (see <code>?periodogram</code>).</p>
</div>
<div id="peaks-finding" class="section level3 unnumbered">
<h3>Peaks finding</h3>
<p>Often, we want to know which are the peak periods in a periodogram. This can be achieved thanks to the <code>find_peaks</code> function. By default, it finds a maximum of three peaks, which are sorted by their power (relative to the significance thershold). Peaks that are not signifant are not accounted for (see the <code>alpha</code> argument).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">per_xsq_dt &lt;-<span class="st"> </span><span class="kw">find_peaks</span>(per_xsq_dt)
per_xsq_dt</code></pre></div>
<p>This function annotates our data by adding a column named <code>&quot;peak&quot;</code>. Whenever the row corresponds to a peak, it puts a number and <code>NA</code> otherwise. The number is the rank of the peak (<code>1</code> being the first/tallest one).</p>
</div>
<div id="visualisation" class="section level3 unnumbered">
<h3>Visualisation</h3>
<p>In <code>ggetho</code>, the function <code>ggperio()</code> is designed specifically for displaying periodograms. One could plot all the periodograms like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggperio</span>(per_xsq_dt) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id, <span class="dt">colour=</span>period_group))</code></pre></div>
<p><img src="rethomics_files/figure-html/unnamed-chunk-133-1.png" width="672" /></p>
<p>But it is very hard to read, so we will <strong>facet per <code>uid</code></strong>. In addition, we can use a special geometry (<code>geom_peak</code>) to show the values of the peak. We draw a signifiance line as well, just using the <code>signif_threshold</code> variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggperio</span>(per_xsq_dt) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id, <span class="dt">colour =</span> period_group)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_peak</span>(<span class="dt">col =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> signif_threshold)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>uid, <span class="dt">ncol =</span> <span class="dv">8</span>)</code></pre></div>
<p><img src="rethomics_files/figure-html/unnamed-chunk-134-1.png" width="1152" /></p>
<p>Instead of drawing only the first peak, you could draw, for instance, the first and second (<code>geom_peak(peak_rank = 1:2)</code>) or, only the second (<code>geom_peak(peak_rank = 2)</code>).</p>
<p>An interesting thing to do is a population average periodogram. In this graph, the solid lines are the average power per group, whilst the shaded areas are ± standard error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggperio</span>(per_xsq_dt, <span class="kw">aes</span>(
                  <span class="dt">y =</span> power <span class="op">-</span><span class="st"> </span>signif_threshold,
                  <span class="dt">colour=</span>period_group)) <span class="op">+</span><span class="st"> </span>
<span class="st">                  </span><span class="kw">stat_pop_etho</span>()</code></pre></div>
<p><img src="rethomics_files/figure-html/unnamed-chunk-135-1.png" width="672" /></p>
</div>
<div id="exctract-the-peak-values" class="section level3 unnumbered">
<h3>Exctract the peak values</h3>
<p>At some point, you would like to <strong>summarise</strong> each animal by, say, it first peak. Then, you can look at whether there are significant differences in peak periodicity vs genotype. Doing that is quite straightforward. First, we <strong>select only rows where peak is exactly 1</strong>, then <a href="https://rethomics.github.io/behavr.html#operating-on-behavr-tables">rejoin</a> our table to its metadata:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summary_dt &lt;-<span class="st"> </span><span class="kw">rejoin</span>(per_xsq_dt[peak<span class="op">==</span><span class="dv">1</span>])
summary_dt</code></pre></div>
<pre><code>##                                         id file_info region_id
##  1: 2017-01-16 08:00:00|dams_sample.txt|01    &lt;list&gt;         1
##  2: 2017-01-16 08:00:00|dams_sample.txt|02    &lt;list&gt;         2
##  3: 2017-01-16 08:00:00|dams_sample.txt|03    &lt;list&gt;         3
##  4: 2017-01-16 08:00:00|dams_sample.txt|04    &lt;list&gt;         4
##  5: 2017-01-16 08:00:00|dams_sample.txt|05    &lt;list&gt;         5
##  6: 2017-01-16 08:00:00|dams_sample.txt|06    &lt;list&gt;         6
##  7: 2017-01-16 08:00:00|dams_sample.txt|07    &lt;list&gt;         7
##  8: 2017-01-16 08:00:00|dams_sample.txt|08    &lt;list&gt;         8
##  9: 2017-01-16 08:00:00|dams_sample.txt|09    &lt;list&gt;         9
## 10: 2017-01-16 08:00:00|dams_sample.txt|10    &lt;list&gt;        10
## 11: 2017-01-16 08:00:00|dams_sample.txt|11    &lt;list&gt;        11
## 12: 2017-01-16 08:00:00|dams_sample.txt|12    &lt;list&gt;        12
## 13: 2017-01-16 08:00:00|dams_sample.txt|13    &lt;list&gt;        13
## 14: 2017-01-16 08:00:00|dams_sample.txt|14    &lt;list&gt;        14
## 15: 2017-01-16 08:00:00|dams_sample.txt|16    &lt;list&gt;        16
## 16: 2017-01-16 08:00:00|dams_sample.txt|17    &lt;list&gt;        17
## 17: 2017-01-16 08:00:00|dams_sample.txt|20    &lt;list&gt;        20
## 18: 2017-01-16 08:00:00|dams_sample.txt|21    &lt;list&gt;        21
## 19: 2017-01-16 08:00:00|dams_sample.txt|22    &lt;list&gt;        22
## 20: 2017-01-16 08:00:00|dams_sample.txt|23    &lt;list&gt;        23
## 21: 2017-01-16 08:00:00|dams_sample.txt|24    &lt;list&gt;        24
## 22: 2017-01-16 08:00:00|dams_sample.txt|25    &lt;list&gt;        25
## 23: 2017-01-16 08:00:00|dams_sample.txt|26    &lt;list&gt;        26
## 24: 2017-01-16 08:00:00|dams_sample.txt|27    &lt;list&gt;        27
## 25: 2017-01-16 08:00:00|dams_sample.txt|28    &lt;list&gt;        28
## 26: 2017-01-16 08:00:00|dams_sample.txt|29    &lt;list&gt;        29
## 27: 2017-01-16 08:00:00|dams_sample.txt|30    &lt;list&gt;        30
## 28: 2017-01-16 08:00:00|dams_sample.txt|31    &lt;list&gt;        31
## 29: 2017-01-16 08:00:00|dams_sample.txt|32    &lt;list&gt;        32
##                                         id file_info region_id
##                           experiment_id      start_datetime
##  1: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  2: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  3: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  4: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  5: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  6: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  7: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  8: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##  9: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 10: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 11: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 12: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 13: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 14: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 15: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 16: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 17: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 18: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 19: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 20: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 21: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 22: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 23: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 24: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 25: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 26: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 27: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 28: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
## 29: 2017-01-16 08:00:00|dams_sample.txt 2017-01-16 08:00:00
##                           experiment_id      start_datetime
##           stop_datetime period_group uid period    power signif_threshold
##  1: 2017-01-26 00:09:00         long   1  99720 276.4555         177.4971
##  2: 2017-01-26 00:09:00         long   2 100440 315.2950         178.7532
##  3: 2017-01-26 00:09:00         long   3 100440 257.1494         178.7532
##  4: 2017-01-26 00:09:00         long   4  95040 268.6532         171.1986
##  5: 2017-01-26 00:09:00         long   5 100440 195.7411         178.7532
##  6: 2017-01-26 00:09:00         long   6  96120 360.2246         172.4607
##  7: 2017-01-26 00:09:00         long   7  98640 200.8368         176.2397
##  8: 2017-01-26 00:09:00         long   8  99720 280.3768         177.4971
##  9: 2017-01-26 00:09:00         long   9 101520 309.5947         180.0083
## 10: 2017-01-26 00:09:00         long  10 103320 246.4732         182.5150
## 11: 2017-01-26 00:09:00        short  11  68040 285.3857         132.6670
## 12: 2017-01-26 00:09:00        short  12  69840 177.5452         135.2830
## 13: 2017-01-26 00:09:00        short  13  67320 307.1445         131.3561
## 14: 2017-01-26 00:09:00        short  14  69120 193.0421         133.9760
## 15: 2017-01-26 00:09:00        short  16  69120 151.6117         133.9760
## 16: 2017-01-26 00:09:00        short  17  69840 225.2747         135.2830
## 17: 2017-01-26 00:09:00        short  20  69840 187.8997         135.2830
## 18: 2017-01-26 00:09:00        short  21  68040 170.8709         132.6670
## 19: 2017-01-26 00:09:00           wt  22  85320 176.0910         157.2301
## 20: 2017-01-26 00:09:00           wt  23  88920 182.2338         162.3284
## 21: 2017-01-26 00:09:00           wt  24  84240 204.4373         155.9519
## 22: 2017-01-26 00:09:00           wt  25  86040 235.2866         158.5068
## 23: 2017-01-26 00:09:00           wt  26  88920 233.0950         162.3284
## 24: 2017-01-26 00:09:00           wt  27  87120 272.0614         159.7821
## 25: 2017-01-26 00:09:00           wt  28  88920 273.3706         162.3284
## 26: 2017-01-26 00:09:00           wt  29  88920 169.5197         162.3284
## 27: 2017-01-26 00:09:00           wt  30  88920 301.1270         162.3284
## 28: 2017-01-26 00:09:00           wt  31  86040 293.7774         158.5068
## 29: 2017-01-26 00:09:00           wt  32  88920 168.8304         162.3284
##           stop_datetime period_group uid period    power signif_threshold
##          p_value peak
##  1: 4.100760e-16    1
##  2: 3.074761e-21    1
##  3: 1.989846e-13    1
##  4: 4.264752e-16    1
##  5: 1.676299e-06    1
##  6: 3.756396e-29    1
##  7: 2.809713e-07    1
##  8: 1.232934e-16    1
##  9: 3.295280e-20    1
## 10: 1.374486e-11    1
## 11: 5.399920e-26    1
## 12: 9.984131e-10    1
## 13: 7.385662e-30    1
## 14: 6.120254e-12    1
## 15: 8.433567e-07    1
## 16: 3.187945e-16    1
## 17: 4.674815e-11    1
## 18: 2.936584e-09    1
## 19: 8.538032e-07    1
## 20: 7.089435e-07    1
## 21: 3.618745e-10    1
## 22: 1.070912e-13    1
## 23: 7.960386e-13    1
## 24: 1.593002e-18    1
## 25: 2.955673e-18    1
## 26: 1.328092e-05    1
## 27: 2.880738e-22    1
## 28: 6.431675e-22    1
## 29: 1.546028e-05    1
##          p_value peak</code></pre>
<p><code>summary_dt</code> can be used as a standard <code>R</code> dataframe for further analysis. For instance, with <code>ggplot</code>, I make a <strong>boxplot showing the distribution of periods</strong>, in h, for each groups. I also add <strong>a point for each animal</strong> (so we see outliers). Then, I make the <strong>size of the points proportional to the relative power of the peak discovered</strong>, so we get an idea of how much to “trust” this point.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(summary_dt, <span class="kw">aes</span>(period_group, period, <span class="dt">fill=</span> period_group)) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.colour =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">size=</span>power <span class="op">-</span><span class="st">  </span>signif_threshold), <span class="dt">alpha=</span>.<span class="dv">5</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">scale_y_hours</span>(<span class="dt">name =</span> <span class="st">&quot;Period (h)&quot;</span>) </code></pre></div>
<p><img src="rethomics_files/figure-html/unnamed-chunk-137-1.png" width="672" /></p>
<p>Another direction could be to perform pairwise wilcoxon tests between groups:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pairwise.wilcox.test</span>(summary_dt<span class="op">$</span>period, summary_dt<span class="op">$</span>period_group )</code></pre></div>
<pre><code>## Warning in wilcox.test.default(xi, xj, paired = paired, ...): cannot
## compute exact p-value with ties

## Warning in wilcox.test.default(xi, xj, paired = paired, ...): cannot
## compute exact p-value with ties

## Warning in wilcox.test.default(xi, xj, paired = paired, ...): cannot
## compute exact p-value with ties</code></pre>
<pre><code>## 
##  Pairwise comparisons using Wilcoxon rank sum test 
## 
## data:  summary_dt$period and summary_dt$period_group 
## 
##       long  short
## short 5e-04 -    
## wt    3e-04 5e-04
## 
## P value adjustment method: holm</code></pre>
<p>This tells us that there is a statistically significant difference between each pair of groups.</p>
</div>
</div>
<div id="next-steps-4" class="section level2 unnumbered">
<h2>Next steps</h2>
<ul>
<li><a href="ggetho.html">Visualise data with <code>ggetho</code></a></li>
<li><a href="sleepr.html">Sleep analysis <code>sleepr</code></a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sleepr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="community.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rethomics/rethomics.github.io/edit/source/09-zeitgebr.Rmd",
"text": "Edit"
},
"download": ["rethomics.pdf", "rethomics.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
